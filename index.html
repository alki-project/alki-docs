
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Introduction Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-forkmegithub/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="assemblies/" />
    
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"alki-project","repo":"alki","type":"star","size":"large"}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Alki</li>
        
        
    
        <li class="chapter active" data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="assemblies/">
            
                <a href="assemblies/">
            
                    
                    Assemblies
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="assemblies/project_assemblies.html">
            
                <a href="assemblies/project_assemblies.html">
            
                    
                    Project Assemblies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="assemblies/manual_creation.html">
            
                <a href="assemblies/manual_creation.html">
            
                    
                    Manually Creating Assemblies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="assemblies/using.html">
            
                <a href="assemblies/using.html">
            
                    
                    Using Assemblies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="assemblies/overrides.html">
            
                <a href="assemblies/overrides.html">
            
                    
                    Overrides
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="assemblies/executables.html">
            
                <a href="assemblies/executables.html">
            
                    
                    Executables
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="dsl/">
            
                <a href="dsl/">
            
                    
                    Assembly Definitions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="dsl/scope.html">
            
                <a href="dsl/scope.html">
            
                    
                    Scope
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="dsl/helpers.html">
            
                <a href="dsl/helpers.html">
            
                    
                    Helpers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="dsl/group.html">
            
                <a href="dsl/group.html">
            
                    
                    group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="dsl/load.html">
            
                <a href="dsl/load.html">
            
                    
                    load
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="dsl/set.html">
            
                <a href="dsl/set.html">
            
                    
                    set
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="dsl/func.html">
            
                <a href="dsl/func.html">
            
                    
                    func
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="dsl/service.html">
            
                <a href="dsl/service.html">
            
                    
                    service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="dsl/factory.html">
            
                <a href="dsl/factory.html">
            
                    
                    factory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="dsl/mount.html">
            
                <a href="dsl/mount.html">
            
                    
                    mount
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="dsl/try_mount.html">
            
                <a href="dsl/try_mount.html">
            
                    
                    try_mount
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="dsl/overlay.html">
            
                <a href="dsl/overlay.html">
            
                    
                    overlay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="dsl/tag.html">
            
                <a href="dsl/tag.html">
            
                    
                    tag
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="dsl/overlay_tag.html">
            
                <a href="dsl/overlay_tag.html">
            
                    
                    overlay_tag
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Alki Projects</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="projects/">
            
                <a href="projects/">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="projects/alki-loader.html">
            
                <a href="projects/alki-loader.html">
            
                    
                    Alki::Loader
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="projects/alki-dsl/">
            
                <a href="projects/alki-dsl/">
            
                    
                    Alki::Dsl
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="projects/alki-dsl/methods.html">
            
                <a href="projects/alki-dsl/methods.html">
            
                    
                    DSL Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="projects/alki-dsl/init-finish.html">
            
                <a href="projects/alki-dsl/init-finish.html">
            
                    
                    Init and Finish
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="projects/alki-dsl/state.html">
            
                <a href="projects/alki-dsl/state.html">
            
                    
                    DSL State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.4" data-path="projects/alki-dsl/require.html">
            
                <a href="projects/alki-dsl/require.html">
            
                    
                    Combining DSLs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.5" data-path="projects/alki-dsl/helpers.html">
            
                <a href="projects/alki-dsl/helpers.html">
            
                    
                    DSL Helpers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.6" data-path="projects/alki-dsl/alki-loader.html">
            
                <a href="projects/alki-dsl/alki-loader.html">
            
                    
                    Using with Alki::Loader
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="projects/alki-rails.html">
            
                <a href="projects/alki-rails.html">
            
                    
                    Alki::Rails
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="projects/alki-reload.html">
            
                <a href="projects/alki-reload.html">
            
                    
                    Alki::Reload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="projects/alki-console.html">
            
                <a href="projects/alki-console.html">
            
                    
                    Alki::Console
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Introduction</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="what-is-alki">What is Alki?</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Alki (AL-kai) is a Dependency Injection framework for Ruby. Alki is designed to help organize and scale your project,
so you can focus on the important stuff.
It can be used alongside frameworks such as <a href="projects/alki-rails.html">Ruby on Rails</a>.</p>
</div>
<div class="paragraph">
<p>Some high level features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Easily manage objects and dependencies</p>
</li>
<li>
<p>Enables writing reusable and testable code</p>
</li>
<li>
<p>Requires no annotations, mixins, or other changes to your code.</p>
</li>
<li>
<p><a href="projects/alki-console.html">Developer console</a> (built on pry)</p>
</li>
<li>
<p>Automatic <a href="projects/alki-reload.html">code reloading</a></p>
</li>
<li>
<p>Powerful <a href="projects/alki-dsl/">DSL toolkit</a></p>
</li>
<li>
<p>Extensible</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For questions or discussion about Alki, head over to the <a href="https://groups.google.com/forum/#!forum/alki-project" target="_blank">Google Group</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add this line to your application&#x2019;s Gemfile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">gem <span class="hljs-string">&apos;alki&apos;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then execute:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ bundle</pre>
</div>
</div>
<div class="paragraph">
<p>Or install it yourself as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ gem install alki</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_use_alki">How to use Alki</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alki simplifies project organization by pulling out all of the &quot;connective tissue&quot;
that connects your classes and modules together.
Alki provides a central place to build your application objects,
where they can easily refer to other objects,
and access configuration settings.</p>
</div>
<div class="paragraph">
<p>For example,
if your project has an http client</p>
</div>
<div class="listingblock">
<div class="title">my_project/http_client.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">MyProject</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpClient</span></span>
    ...
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you might normally use it by either creating a new instance of it when needed,
or directly calling methods on the class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">client = <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.new
client.get <span class="hljs-string">&apos;/page1.html&apos;</span>
<span class="hljs-comment"># -or-</span>
<span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.get <span class="hljs-string">&apos;/page1.html&apos;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With Alki, you would instead define instructions for how to build the http client.</p>
</div>
<div class="listingblock">
<div class="title">config/assembly.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
  service <span class="hljs-symbol">:http_client</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project/http_client&apos;</span>
    <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.new
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The &apos;service&apos; method defines a new object with the name &apos;http_client&apos;,
and the provided block contains the code needed to build it.</p>
</div>
<div class="paragraph">
<p>To use the http client, an &quot;Assembly&quot; for the project has to be created.
Assemblies are container objects that hold your application objects once
they&#x2019;re built.</p>
</div>
<div class="paragraph">
<p>Typically you can just add the following code to your project&#x2019;s main library file.
More information can be found about this method <a href="assemblies/project_assemblies.html">here</a>.</p>
</div>
<div class="listingblock">
<div class="title">lib/my_project.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&apos;alki&apos;</span>
Alki.project_assembly!</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will add a &apos;new&apos; method to the the MyProject module,
which will return a new Assembly instance.
The http client can be accessed by calling the method that matches the name we chose for it
when it was defined,
&apos;http_client&apos;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project&apos;</span>

app = MyProject.new
app.http_client.get <span class="hljs-string">&apos;/page1.html&apos;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_settings">Configuration Settings</h3>
<div class="paragraph">
<p>Most projects, at some point,
have to deal with configuration settings.</p>
</div>
<div class="paragraph">
<p>In Ruby the typical pattern is to reference Modules and Classes directly,
either by constructing them on demand when needed,
or calling class methods on them.</p>
</div>
<div class="paragraph">
<p>Often this leaves Modules and Classes to essentially have to configure themselves.
Sometimes this is by pulling configuration from the environment or a configration file,
sometimes it&#x2019;s by requiring a global variable to be set before the class is used.</p>
</div>
<div class="paragraph">
<p>This means that classes are often cluttered with configuration code.
Classes from different libraries might have different, inconsistent ways of being configured,
and it can be difficult if not impossible to change how they&#x2019;re configured.</p>
</div>
<div class="paragraph">
<p>In Alki, configuration becomes straightforward.
Classes can just take configuration settings as initializer parameters,
without worrying about where they comes from.</p>
</div>
<div class="listingblock">
<div class="title">lib/my_project/http_client.rb</div>
<div class="content">
<pre class="highlight"><code>module MyProject
  class HttpClient
    def initializer(base_uri)
      @base_uri = base_uri
    end
    ...
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the Assembly can be updated to pass in a configuration parameter.
We can also define a new element for our base_url setting.</p>
</div>
<div class="listingblock">
<div class="title">config/assembly.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
  set <span class="hljs-symbol">:http_base_url</span> <span class="hljs-keyword">do</span>
     ENV.fetch(<span class="hljs-string">&apos;HTTP_BASE_URL&apos;</span>)
  <span class="hljs-keyword">end</span>

  service <span class="hljs-symbol">:http_client</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project/http_client&apos;</span>
    <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.new http_base_url
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The &apos;set&apos; method is used to define simple values in the Assembly,
and the http client can refer to it by name.</p>
</div>
<div class="paragraph">
<p>Nothing changes with how we use the http client,
but it&#x2019;s now pulling it&#x2019;s configuration from the environment.</p>
</div>
<div class="paragraph">
<p>Changing this to have a default value,
pull from a different source,
or have multiple clients with different configuration parameters
can be done easily without changing the class code.</p>
</div>
<div class="paragraph">
<p>For example,
to change the settings to come from a YAML file we can define a new
element to parse the YAML file,
and then redifine our setting to pull it&#x2019;s value from the parsed options.
Note that the order doesn&#x2019;t matter.
Even if a dependency is defined after an element that uses it,
the objects will still be built in the correct order.</p>
</div>
<div class="listingblock">
<div class="title">config/assembly.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
  set <span class="hljs-symbol">:yaml_settings</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;yaml&apos;</span>
    YAML.load_file File.join(config_dir,<span class="hljs-string">&apos;settings.yml&apos;</span>)
  <span class="hljs-keyword">end</span>

  set <span class="hljs-symbol">:http_base_url</span> <span class="hljs-keyword">do</span>
    yaml_settings[<span class="hljs-string">&apos;http_base_ur&apos;</span>]
  <span class="hljs-keyword">end</span>

  service <span class="hljs-symbol">:http_client</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project/http_client&apos;</span>
    <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.new http_base_url
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No changes to the class,
or in this case even the build code for the http client,
are required.</p>
</div>
<div class="paragraph">
<p>Configuration settings can be grouped together in the assembly,
to namespace them.
This group can be called anything, but we&#x2019;ll call it &apos;settings&apos;.</p>
</div>
<div class="listingblock">
<div class="title">config/assembly.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
  group <span class="hljs-symbol">:settings</span> <span class="hljs-keyword">do</span>
    set <span class="hljs-symbol">:http_base_url</span> <span class="hljs-keyword">do</span>
      yaml_settings[<span class="hljs-string">&apos;http_base_ur&apos;</span>]
    <span class="hljs-keyword">end</span>

    set <span class="hljs-symbol">:yaml_settings</span> <span class="hljs-keyword">do</span>
      <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;yaml&apos;</span>
      YAML.parse(File.read(File.join(config_dir,<span class="hljs-string">&apos;settings.yml&apos;</span>)))
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  service <span class="hljs-symbol">:http_client</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project/http_client&apos;</span>
    <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.new settings.http_base_url
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The can also be moved to an entirely different file to keep them
seperate from your application objects.</p>
</div>
<div class="listingblock">
<div class="title">config/settings.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
  set <span class="hljs-symbol">:http_base_url</span> <span class="hljs-keyword">do</span>
    yaml_settings[<span class="hljs-string">&apos;http_base_ur&apos;</span>]
  <span class="hljs-keyword">end</span>

  set <span class="hljs-symbol">:yaml_settings</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;yaml&apos;</span>
    YAML.parse(File.read(File.join(config_dir,<span class="hljs-string">&apos;settings.yml&apos;</span>)))
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">config/assembly.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
  load <span class="hljs-symbol">:settings</span>

  service <span class="hljs-symbol">:http_client</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project/http_client&apos;</span>
    <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.new settings.http_base_url
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependency_injection">Dependency Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Dependency Injection is a way of designing your classes to maximise
their modularity and reusability.</p>
</div>
<div class="paragraph">
<p>Much like with configuration settings,
instead of directly referencing a classes dependencies a depenency injected
class takes it&#x2019;s dependencies as arguments.</p>
</div>
<div class="paragraph">
<p>The advantage of this is that classes can be developed and tested in isolation,
can have dependencies easily changed by other code (like users of a library),
or have multiple instances with different dependencies.</p>
</div>
<div class="paragraph">
<p>Like configuration settings,
a lot of Ruby projects end up needing some amount of dependency injection,
but it&#x2019;s typically implemented in an ad-hoc way with class variables or other global
variables.</p>
</div>
<div class="paragraph">
<p>With Alki, dependency injection is the norm and very straightforward.</p>
</div>
<div class="paragraph">
<p>Perhaps we have client for API that works over HTTP.
We can write our API client so that it takes an HTTP client as an arugment
and just calls methods on it.
It doesn&#x2019;t need to pick a particular client library or decide what configuration
settings it should have.</p>
</div>
<div class="listingblock">
<div class="title">lib/my_project/api_client.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">MyProject</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiClient</span></span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initialize</span><span class="hljs-params">(http_client)</span></span>
      @http_client = http_client
    <span class="hljs-keyword">end</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all</span></span>
      parse_response @http_client.get(<span class="hljs-string">&apos;/all.json&apos;</span>)
    <span class="hljs-keyword">end</span>

    ...
   <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this design it&#x2019;s easy to change out the http client,
or provide a stubbed or mocked one for testing.
It maximizes the reusability of our API client
because it only handles one thing
(Single Responsibility Principle).</p>
</div>
<div class="paragraph">
<p>To add it to the previous assembly definition.</p>
</div>
<div class="listingblock">
<div class="title">config/assembly.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">  load <span class="hljs-symbol">:settings</span>

  service <span class="hljs-symbol">:api_client</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project/api_client&apos;</span>
    <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:ApiClient</span>.new http_client
  <span class="hljs-keyword">end</span>

  service <span class="hljs-symbol">:http_client</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;my_project/http_client&apos;</span>
    <span class="hljs-symbol">MyProject:</span><span class="hljs-symbol">:HttpClient</span>.new settings.http_base_url
  <span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example">Example</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Full &quot;todo&quot; source code can be found <a href="https://github.com/alki-project/alki-examples/tree/master/todo" target="_blank">here</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To demonstrate how a full Alki project can be put together,
we&#x2019;ll go through an example application.
This application is a little todo list command line utility
that stores the todo list in a json file.</p>
</div>
<div class="listingblock">
<div class="title">lib/todo.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"><span class="hljs-keyword">require</span> <span class="hljs-string">&apos;alki&apos;</span>
Alki.project_assembly!</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a module called <code>Todo</code> that is an empty assembly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ bundle exec irb -Ilib
2.4.0 :001 &gt; require &apos;todo&apos;
 =&gt; true
2.4.0 :002 &gt; todo = Todo.new
 =&gt; #&lt;Todo:21964520&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="defining-elements">Defining Elements</h3>
<div class="paragraph">
<p>Adding things to the assembly requires an Assembly definition file.
By convention this is named <code>config/assembly.rb</code> and is built using a DSL.
There are a handful of different element types in Assemblies.
Elements can refer to other elements, and can be defined in any order.</p>
</div>
<div class="paragraph">
<p>Full documentation of the DSL can be found <a href="dsl/">here</a>.</p>
</div>
<div class="paragraph">
<p>Below is an example Assembly definition for the todo application
which uses a few of the core element types.</p>
</div>
<div class="listingblock">
<div class="title">config/assembly.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
  load <span class="hljs-symbol">:settings</span>

  service <span class="hljs-symbol">:interface</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;todo/readline_interface&apos;</span>
    <span class="hljs-symbol">Todo:</span><span class="hljs-symbol">:ReadlineInterface</span>.new settings.prompt, handler
  <span class="hljs-keyword">end</span>

  service <span class="hljs-symbol">:handler</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;todo/command_handler&apos;</span>
    <span class="hljs-symbol">Todo:</span><span class="hljs-symbol">:CommandHandler</span>.new db
  <span class="hljs-keyword">end</span>

  service <span class="hljs-symbol">:db</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;todo/store_db&apos;</span>
    <span class="hljs-symbol">Todo:</span><span class="hljs-symbol">:StoreDb</span>.new file_store
  <span class="hljs-keyword">end</span>

  service <span class="hljs-symbol">:file_store</span> <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">require</span> <span class="hljs-string">&apos;todo/json_file_store&apos;</span>
    <span class="hljs-symbol">Todo:</span><span class="hljs-symbol">:JsonFileStore</span>.new settings.db_path
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with a settings file to define our application settings.</p>
</div>
<div class="listingblock">
<div class="title">config/settings.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">Alki <span class="hljs-keyword">do</span>
 set(<span class="hljs-symbol">:home</span>) { ENV[<span class="hljs-string">&apos;HOME&apos;</span>] }
 set(<span class="hljs-symbol">:db_path</span>) { ENV[<span class="hljs-string">&apos;TODO_DB_PATH&apos;</span>] || File.join(home,<span class="hljs-string">&apos;.todo_db&apos;</span>) }
 set <span class="hljs-symbol">:prompt</span>, <span class="hljs-string">&apos;todo&gt; &apos;</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Settings and services can be accessed by requiring the main &quot;lib/todo.rb&quot; file,
creating a new assembly instance,
and then calling methods to refer to the different elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ bundle exec irb -Ilib
2.4.0 :001 &gt; require &apos;todo&apos;
 =&gt; true
2.4.0 :002 &gt; todo = Todo.new
 =&gt; #&lt;Todo:21964520&gt;
2.4.0 :003 &gt; todo.settings.prompt
 =&gt; &quot;&gt; &quot;
2.4.0 :004 &gt; todo.interface.run
&gt; ?
All commands can be shortened to their first letters
print
add &lt;description&gt;
edit &lt;id&gt; &lt;description&gt;
complete &lt;id&gt;
uncomplete &lt;id&gt;
remove &lt;id&gt;
move &lt;from&gt; &lt;to&gt;
quit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="projects/alki-console.html">alki-console</a> developer console gem can also be used to quickly work with assemblies.
It can be used by adding <code>gem &apos;alki-console&apos;</code> to the Gemfile and running <code>bundle --binstubs</code> to add the console script to the &apos;bin&apos; directory.</p>
</div>
<div class="paragraph">
<p>Elements can be accessed directly without having to manually create an
assembly instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ bin/alki-console
todo&gt; settings.prompt
=&gt; &apos;todo&gt; &apos;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="executable">Creating an executable</h3>
<div class="paragraph">
<p>Read more about creating executables with Alki,
including how to create executables to distribute in a gem,
<a href="assemblies/executables.html">here</a></p>
</div>
<div class="paragraph">
<p>In the todo example, it&#x2019;s a CLI utility so it requires an executable.
The executable just needs to require the main project file,
create a new instance of the assembly,
and call a method on a service.</p>
</div>
<div class="listingblock">
<div class="title">bin/todo</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby"><span class="hljs-comment">#!/usr/bin/env ruby</span>

<span class="hljs-comment"># Setup</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">&apos;bundler/setup&apos;</span>
<span class="hljs-keyword">require</span> <span class="hljs-string">&apos;alki/bin&apos;</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">&apos;todo&apos;</span>
Todo.new.interface.run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ bin/todo
&gt; print
1. take out the trash
&gt; quit
$</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documentation">Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>More documentation can be found at <a href="http://alki.io" target="_blank">alki.io</a>,
with in-depth explanations of <a href="assemblies/">Assemblies</a>,
<a href="dsl/">the Assembly DSL</a>, and other
<a href="projects/">projects</a> that are part of Alki.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authors">Authors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Written by Matt Edlefsen</p>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="assemblies/" class="navigation navigation-next navigation-unique" aria-label="Next page: Assemblies">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Introduction","level":"1.1","depth":1,"next":{"title":"Assemblies","level":"1.2","depth":1,"path":"assemblies/README.adoc","ref":"assemblies/README.adoc","articles":[{"title":"Project Assemblies","level":"1.2.1","depth":2,"path":"assemblies/project_assemblies.adoc","ref":"assemblies/project_assemblies.adoc","articles":[]},{"title":"Manually Creating Assemblies","level":"1.2.2","depth":2,"path":"assemblies/manual_creation.adoc","ref":"assemblies/manual_creation.adoc","articles":[]},{"title":"Using Assemblies","level":"1.2.3","depth":2,"path":"assemblies/using.adoc","ref":"assemblies/using.adoc","articles":[]},{"title":"Overrides","level":"1.2.4","depth":2,"path":"assemblies/overrides.adoc","ref":"assemblies/overrides.adoc","articles":[]},{"title":"Executables","level":"1.2.5","depth":2,"path":"assemblies/executables.adoc","ref":"assemblies/executables.adoc","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["forkmegithub","ga","github-buttons"],"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"github-buttons":{"buttons":[{"user":"alki-project","repo":"alki","type":"star","size":"large"}]},"ga":{"configuration":"auto","token":"UA-116417946-1"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"forkmegithub":{"color":"gray","url":"https://github.com/alki-project/alki"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"README.adoc","mtime":"2018-04-02T11:02:45.706Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2018-04-02T11:03:25.502Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-forkmegithub/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

